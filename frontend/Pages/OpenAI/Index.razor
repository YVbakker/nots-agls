@page "/openai"

<PageTitle>OpenAI</PageTitle>

@inject OpenAIService OpenAIService

<div class="row my-3">
    <nav aria-label="breadcrumb" class="d-flex flex-row justify-content-between align-items-center">
        <ol class="breadcrumb m-0">
            <li class="breadcrumb-item">
                <a href="/">Home</a>
            </li>
            <li class="breadcrumb-item" aria-current="page">OpenAI</li>
            <li class="breadcrumb-item active" aria-current="page">View All</li>
        </ol>
    </nav>
</div>

<div class="card mb-3">
    <h5 class="card-header text-white bg-primary">Git commit message</h5>
    <div class="card-body">
        <p>
            Paste a git commit message here and click on the buttons in the cards below to run the text throught an AI.
        </p>
        <textarea @bind="@gitCommitMessage" class="form-control" id="extractionInput" rows="3"
            placeholder="Paste a git commit message here">
        </textarea>
    </div>
</div>

<div class="card mb-3">
    <h5 class="card-header text-white bg-secondary">Text extraction</h5>
    <div class="card-body">
        <p>Extract the reasons of the changes made in given commit.</p>
        <button @onclick="handleTextExtraction" type="button" class="btn btn-secondary">Extract text</button>
        <hr />
        @if (extractionInProgress)
        {
            <div class="spinner-border d-block" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
        }
        @if (extractionResult != null)
        {
            <label class="fw-bold">Result</label>
            <p>@extractionResult</p>
        }
    </div>
</div>

<div class="card mb-3">
    <h5 class="card-header text-white bg-secondary">Text summarization</h5>
    <div class="card-body">
        <p>Make a summary of the commit message containing key elements.</p>
        <button @onclick="handleTextSummarization" type="button" class="btn btn-secondary">Summarize text</button>
        <hr />
        @if (summarizationInProgress)
        {
            <div class="spinner-border d-block" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
        }
        @if (summarizationResult != null)
        {
            <label class="fw-bold">Result</label>
            <p>@summarizationResult</p>
        }
    </div>
</div>

@code
{
    private string? gitCommitMessage { get; set; }
    private string? extractionResult { get; set; }
    private bool extractionInProgress { get; set; }
    private string? summarizationResult { get; set; }
    private bool summarizationInProgress { get; set; }


    private async void handleTextExtraction()
    {
        extractionInProgress = true;
        StateHasChanged();

        var dto = new OpenAIExtractDTO();
        dto.prompt = gitCommitMessage;

        var result = await OpenAIService.extractReasons(dto);
        extractionResult = result.choices[0].text;
        extractionInProgress = false;
        StateHasChanged();
    }

    private async void handleTextSummarization()
    {
        summarizationInProgress = true;
        StateHasChanged();

        var dto = new OpenAISummarizeDTO();
        dto.prompt = gitCommitMessage;

        var result = await OpenAIService.summarizeText(dto);
        summarizationResult = result.choices[0].text;
        summarizationInProgress = false;
        StateHasChanged();
    }
}